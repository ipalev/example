!function(e){"function"==typeof define&&define.amd?define("scripts",e):e()}((function(){"use strict";let initProductSlider=function(e){initSlider();let t=document.querySelector(`[href="#${e}"]`),a=document.getElementById(e),o=a.parentNode;if(t&&a&&(t.classList.remove("u-hidden"),a.classList.remove("u-hidden")),!o.querySelector('[role="tabpanel"].active:not(.u-hidden)')){let e=o.querySelector('[role="tabpanel"]:not(.u-hidden)');e&&(document.querySelectorAll(`[href="#${e.id}"]`).forEach((e=>{e.classList.add("active")})),e.classList.add("active","show"))}};document.addEventListener("rcm-section:successShownAction",(e=>{if(!e.detail.requestData||!e.detail.requestData.container)return;let t=e.detail.requestData.container.substring("container-".length);initProductSlider(t)})),document.addEventListener("ContentDeferredDone",(e=>{-1!==["slider-latest"].indexOf(e.detail.deferred_block_id)&&initProductSlider(e.detail.deferred_block_id)}));let createPopupEvent=e=>new CustomEvent("popup:open",{detail:e});document.addEventListener("basket:onchange",(e=>{if(!document.getElementById("cart-page")&&"increase"===e.detail.after&&e.detail.product_fields&&e.detail.product_fields.hasOwnProperty(e.detail.product_id)){let t=e.detail.product_fields[e.detail.product_id],a={title:"Товар добавлен в корзину",text:t.name,img:t.picture};e.detail.modal_basket&&(a.button={modal:!0,id:"#modalCart",text:"Открыть"}),document.dispatchEvent(createPopupEvent(a))}})),document.addEventListener("personal-order:repeat-success",(e=>{document.dispatchEvent(createPopupEvent({title:"Готово",text:"Содержимое заказа добавлено в корзину",img:"/local/templates/stereozona/include/images/success.png",button:{modal:!0,id:"#modalCart",text:"Смотреть в корзине"}}))})),document.addEventListener("personal-order:repeat-fail",(e=>{document.dispatchEvent(createPopupEvent({title:"Ошибка",text:e.detail.error,img:"/local/templates/stereozona/include/images/error.png"}))})),document.addEventListener("onErrorFormSubmit",(e=>{document.dispatchEvent(createPopupEvent({title:"Ошибка",text:e.detail.message,img:"/local/templates/stereozona/include/images/error.png"}))})),document.addEventListener("onSuccessFormSubmit",(e=>{document.dispatchEvent(createPopupEvent({title:"Успех",text:e.detail.message,img:"/local/templates/stereozona/include/images/success.png"}))})),document.addEventListener("basket:coupon-applied",(e=>{let t=e.detail.coupon;document.dispatchEvent(createPopupEvent({title:"Купон "+t.COUPON,text:t.JS_CHECK_CODE,img:"/local/templates/stereozona/include/images/success.png"}))})),document.addEventListener("basket:coupon-fail",(e=>{let t=e.detail.coupon;document.dispatchEvent(createPopupEvent({title:"Купон "+t.COUPON,text:t.JS_CHECK_CODE,img:"/local/templates/stereozona/include/images/error.png"}))})),document.addEventListener("soa:component.error",(e=>{document.dispatchEvent(createPopupEvent({title:"Ошибка оформления заказа",text:e.detail.message,img:"/local/templates/stereozona/include/images/error.png"}))})),document.addEventListener("soa:component.order-saved",(e=>{document.dispatchEvent(createPopupEvent({title:"Заказ успешно оформлен",text:"",img:"/local/templates/stereozona/include/images/success.png"}))})),document.addEventListener("comparison:add-success",(e=>{document.dispatchEvent(createPopupEvent({title:e.detail.message,text:"",img:"/local/templates/stereozona/include/images/success.png"}))})),document.addEventListener("comparison:add-success",(e=>{document.dispatchEvent(createPopupEvent({title:e.detail.message,text:"",img:"/local/templates/stereozona/include/images/success.png"}))})),document.addEventListener("favourites:add-success",(e=>{document.dispatchEvent(createPopupEvent({title:e.detail.message,text:"",img:"/local/templates/stereozona/include/images/success.png"}))})),document.addEventListener("favourites:add-error",(e=>{document.dispatchEvent(createPopupEvent({title:"Ошибка добавления в избранное",text:e.detail.message,img:"/local/templates/stereozona/include/images/error.png"}))})),document.addEventListener("favourites:del-success",(e=>{document.dispatchEvent(createPopupEvent({title:e.detail.message,text:"",img:"/local/templates/stereozona/include/images/success.png"}))})),document.addEventListener("iblock-form:register-success",(e=>{if(e.detail.data&&e.detail.data.subscription){let t=e.detail.data.subscription.success,a=t?e.detail.data.subscription.message:e.detail.data.subscription.errors.join("\n");document.dispatchEvent(createPopupEvent({title:`Вы ${t?"":"не"}подписаны на рассылку`,text:a,img:`/local/templates/stereozona/include/images/${t?"success":"error"}.png`}))}})),document.addEventListener("favourites:del-error",(e=>{document.dispatchEvent(createPopupEvent({title:"Ошибка удаления из избранного",text:e.detail.message,img:"/local/templates/stereozona/include/images/error.png"}))})),document.addEventListener("iblock-form:auth-fail",(e=>{document.dispatchEvent(createPopupEvent({title:"",text:e.detail.message,img:"/local/templates/stereozona/include/images/error.png"}))})),document.addEventListener("iblock-form:register-fail",(e=>{document.dispatchEvent(createPopupEvent({title:"",text:e.detail.message,img:"/local/templates/stereozona/include/images/error.png"}))})),document.addEventListener("city: identified-success",(e=>{document.dispatchEvent(createPopupEvent({title:"Ваш город",text:e.detail.message,img:"/local/templates/stereozona/include/images/success.png"}))})),document.addEventListener("city: identified-error",(e=>{document.dispatchEvent(createPopupEvent({title:"Ошибка определения города",text:"",img:"/local/templates/stereozona/include/images/error.png"}))})),document.addEventListener("sale-profile: error",(e=>{document.dispatchEvent(createPopupEvent({title:"Ошибка сохранения профиля",text:e.detail.message,img:"/local/templates/stereozona/include/images/error.png"}))})),document.addEventListener("profile-form:save-success",(e=>{document.dispatchEvent(createPopupEvent({title:"Данные сохранены успешно",text:"",img:"/local/templates/stereozona/include/images/success.png"}))})),document.addEventListener("profile-form:save-fail",(e=>{document.dispatchEvent(createPopupEvent({title:"Ошибка обновления данных",text:e.detail.message,img:"/local/templates/stereozona/include/images/error.png"}))})),document.addEventListener("soa:failed-location-response",(e=>{document.dispatchEvent(createPopupEvent({title:e.detail.response.message,text:e.detail.suggestion_data.value,img:"/local/templates/stereozona/include/images/error.png"}))})),document.addEventListener("deferred-load:force",(function(){let e=document.querySelectorAll("[data-deferredload-marker]");e.length&&Array.from(e).forEach((function(e){let t=e.dataset.deferredloadMarker;t&&BX.ajax({method:"GET",url:BX.util.add_url_param(location.href,{"request-action":"deferredload",deferred_block_marker:t}),headers:[{name:"X-Requested-With",value:"deferredload"},{name:"Accept",value:"text/html, application/xhtml+xml"}],onsuccess:function(t){let a=BX.processHTML(t,!0);BX.ajax.processScripts(a.SCRIPT,!0),e.insertAdjacentHTML("afterend",a.HTML)},onfailure:function(){console.log("deferredload component: failed to load deferred block '"+t+"'")}})}))})),window.JCCatalogSectionComponent||(window.JCCatalogSectionComponent=function(e){this.formPosting=!1,this.siteId=e.siteId||"",this.ajaxId=e.ajaxId||"",this.template=e.template||"",this.componentPath=e.componentPath||"",this.parameters=e.parameters||"",e.navParams&&(this.navParams={NavNum:e.navParams.NavNum||1,NavPageNomer:parseInt(e.navParams.NavPageNomer)||1,NavPageCount:parseInt(e.navParams.NavPageCount)||1}),this.bigData=e.bigData||{enabled:!1},this.container=document.querySelector('[data-entity="'+e.container+'"]'),this.showMoreButton=null,this.showMoreButtonMessage=null,this.bigData.enabled&&BX.util.object_keys(this.bigData.rows).length>0&&(BX.cookie_prefix=this.bigData.js.cookiePrefix||"",BX.cookie_domain=this.bigData.js.cookieDomain||"",BX.current_server_time=this.bigData.js.serverTime,BX.ready(BX.delegate(this.bigDataLoad,this))),e.initiallyShowHeader&&BX.ready(BX.delegate(this.showHeader,this)),e.deferredLoad&&BX.ready(BX.delegate(this.deferredLoad,this)),e.lazyLoad&&(this.showMoreButton=document.querySelector('[data-use="show-more-'+this.navParams.NavNum+'"]'),this.showMoreButtonMessage=this.showMoreButton.innerHTML,BX.bind(this.showMoreButton,"click",BX.proxy(this.showMore,this))),e.loadOnScroll&&BX.bind(window,"scroll",BX.proxy(this.loadOnScroll,this))},window.JCCatalogSectionComponent.prototype={checkButton:function(){this.showMoreButton&&(this.navParams.NavPageNomer==this.navParams.NavPageCount?BX.remove(this.showMoreButton):this.container.appendChild(this.showMoreButton))},enableButton:function(){this.showMoreButton&&(BX.removeClass(this.showMoreButton,"disabled"),this.showMoreButton.innerHTML=this.showMoreButtonMessage)},disableButton:function(){this.showMoreButton&&(BX.addClass(this.showMoreButton,"disabled"),this.showMoreButton.innerHTML=BX.message("BTN_MESSAGE_LAZY_LOAD_WAITER"))},loadOnScroll:function(){var e=BX.GetWindowScrollPos().scrollTop,t=BX.pos(this.container).bottom;e+window.innerHeight>t&&this.showMore()},showMore:function(){if(this.navParams.NavPageNomer<this.navParams.NavPageCount){var e={action:"showMore"};e["PAGEN_"+this.navParams.NavNum]=this.navParams.NavPageNomer+1,this.formPosting||(this.formPosting=!0,this.disableButton(),this.sendRequest(e))}},bigDataLoad:function(){var e="https://analytics.bitrix.info/crecoms/v1_0/recoms.php",t=BX.ajax.prepareData(this.bigData.params);t&&(e+=(-1!==e.indexOf("?")?"&":"?")+t);var a=BX.delegate((function(e){this.sendRequest({action:"deferredLoad",bigData:"Y",items:e&&e.items||[],rid:e&&e.id,count:this.bigData.count,rowsRange:this.bigData.rowsRange,shownIds:this.bigData.shownIds,container:this.container.dataset.entity})}),this);BX.ajax({method:"GET",dataType:"json",url:e,timeout:3,onsuccess:a,onfailure:a})},deferredLoad:function(){this.sendRequest({action:"deferredLoad"})},sendRequest:function(e){var t={siteId:this.siteId,template:this.template,parameters:this.parameters};this.ajaxId&&(t.AJAX_ID=this.ajaxId),BX.ajax({url:this.componentPath+"/ajax.php"+(-1!==document.location.href.indexOf("clear_cache=Y")?"?clear_cache=Y":""),method:"POST",dataType:"json",timeout:60,data:BX.merge(t,e),onsuccess:BX.delegate((function(t){t&&t.JS&&(BX.ajax.processScripts(BX.processHTML(t.JS).SCRIPT,!1,BX.delegate((function(){this.showAction(t,e),document.dispatchEvent(new CustomEvent("rcm-section:successShownAction",{detail:{requestData:e,response:t}}))}),this)),document.dispatchEvent(new CustomEvent("rcm-section:successRequest",{detail:e})))}),this)})},showAction:function(e,t){if(t)switch(t.action){case"showMore":this.processShowMoreAction(e);break;case"deferredLoad":this.processDeferredLoadAction(e,"Y"===t.bigData)}},processShowMoreAction:function(e){this.formPosting=!1,this.enableButton(),e&&(this.navParams.NavPageNomer++,this.processItems(e.items),this.processPagination(e.pagination),this.checkButton())},processDeferredLoadAction:function(e,t){if(e){var a=t?this.bigData.rows:{};this.processItems(e.items,BX.util.array_keys(a))}},processItems:function(e,t){if(e){var a,o,s,i=BX.processHTML(e,!1),r=BX.create("DIV");if(r.innerHTML=i.HTML,(a=r.querySelectorAll('[data-entity="items-row"]')).length)for(o in this.showHeader(!0),a)a.hasOwnProperty(o)&&((s=!!t&&this.container.querySelectorAll('[data-entity="items-row"]'))&&BX.type.isDomNode(s[t[o]])?s[t[o]].parentNode.insertBefore(a[o],s[t[o]]):this.container.appendChild(a[o]));BX.ajax.processScripts(i.SCRIPT)}},processPagination:function(e){if(e){var t=document.querySelectorAll('[data-pagination-num="'+this.navParams.NavNum+'"]');for(var a in t)t.hasOwnProperty(a)&&(t[a].innerHTML=e)}},showHeader:function(e){var t,a=BX.findParent(this.container,{attr:{"data-entity":"parent-container"}});a&&BX.type.isDomNode(a)&&(t=a.querySelector('[data-entity="header"]'))&&"true"!=t.getAttribute("data-showed")&&(t.style.display="",e?new BX.easing({duration:2e3,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(e){t.style.opacity=e.opacity/100},complete:function(){t.removeAttribute("style"),t.setAttribute("data-showed","true")}}).animate():t.style.opacity=100)}}),document.addEventListener("DOMContentLoaded",(function(){$(document).on("click",".js__pagination",(e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let t=e.target.closest(".js__pagination"),a=t.dataset.paginationId,o=t.dataset.url,s=void 0!==t.dataset.removeContent,i=`[data-container-pagination-id="${a}"]`,r=document.querySelector(i);a&&o&&r&&$.ajax({type:"get",url:o,data:{pagination_type:a},dataType:"json",success:function(e){let o=e.pagination,n=e.items;o&&t.insertAdjacentHTML("afterend",o),t.remove(),s&&(r.innerHTML=""),n&&r.insertAdjacentHTML("beforeend",n);let l=document.querySelectorAll(".js-observe");for(var d=0;d<l.length;d++)console.log(l[d]),l[d].classList.add("is-visible");let c=new CustomEvent("onPagenContentLoaded",{detail:{containerSelector:i,name:a}});document.dispatchEvent(c)}})}))}));class ItsUtils{static Declension(e,t,a,o){return e=Math.abs(e),(e%=100)>=5&&e<=20?o:1===(e%=10)?t:e>=2&&e<=4?a:o}static replaceArrays(e,t,a){let o;return t.forEach((function(t,s){o=new RegExp(t,"g"),e=e.replace(o,a[s])})),e}static debounce(e,t){let a=null;return function(...o){a&&clearTimeout(a),a=setTimeout((()=>{e.apply(this,o),a=null}),t)}}}class BasketPoolQuantity{constructor(){this.processing=!1,this.poolQuantity={},this.updateTimer=null,this.currentQuantity={},this.lastStableQuantities={},this.updateQuantity()}updateQuantity(){const e=BX("basket_items").querySelectorAll(".cart-item");e.length>0&&e.forEach((e=>{this.currentQuantity[e.dataset.cartId]=BX("QUANTITY_"+e.dataset.cartId).value})),this.lastStableQuantities=BX.clone(this.currentQuantity,!0)}changeQuantity(e){const t=BX("QUANTITY_"+e.basket_id).value,a=this.isPoolEmpty();this.currentQuantity[e.basket_id]&&this.currentQuantity[e.basket_id]!=t&&(this.poolQuantity[e.basket_id]=this.currentQuantity[e.basket_id]=t),a?this.trySendPool(e):this.enableTimer(!0,e)}trySendPool(e){this.isPoolEmpty()||this.isProcessing()||(this.enableTimer(!1),Basket.recalcBasketAjax({counter:!0,extEventData:e}))}isPoolEmpty(){return 0===Object.keys(this.poolQuantity).length}clearPool(){this.poolQuantity={}}isProcessing(){return!0===this.processing}setProcessing(e){this.processing=!0===e}enableTimer(e,t=!1){clearTimeout(this.updateTimer),!1!==e&&(this.updateTimer=setTimeout((()=>{this.trySendPool(t)}),1500))}}class Basket$1{static updateBasketTable(e,t,a=!1){let o=BX("basket_items");if(!o||"object"!=typeof t)return;o.innerHTML="";let s={};if(window.cartTemplate&&t.BASKET_DATA.MUTATOR&&"object"==typeof t.BASKET_DATA.MUTATOR.REPLACE_FIELDS)for(let e in t.BASKET_DATA.MUTATOR.REPLACE_FIELDS)if(t.BASKET_DATA.MUTATOR.REPLACE_FIELDS.hasOwnProperty(e)){let a=t.BASKET_DATA.MUTATOR.REPLACE_FIELDS[e],s="";s+=ItsUtils.replaceArrays(window.cartTemplate,Object.keys(a),Object.values(a)),o.insertAdjacentHTML("beforeend",s)}BX("allSum")&&(BX("allSum").innerHTML=t.BASKET_DATA.allSum_FORMATED),BX("allSumFull")&&(BX("allSumFull").innerHTML=t.BASKET_DATA.PRICE_WITHOUT_DISCOUNT),BX("count_text")&&(BX("count_text").innerHTML=t.BASKET_DATA.MUTATOR.BASKET_COUNT_TEXT),BX("minicart_sum")&&(BX("minicart_sum").innerHTML=t.BASKET_DATA.allSum_FORMATED),BX("minicart_count")&&(BX("minicart_count").innerHTML=t.BASKET_DATA.MUTATOR.BASKET_COUNT),BX("discount")&&(BX("discount").innerHTML=t.BASKET_DATA.DISCOUNT_PRICE_ALL_FORMATED);let i=!!window.basketJSParams.MODAL;if(t.BASKET_DATA.MUTATOR&&t.BASKET_DATA.MUTATOR.PRODUCT_FIELDS)for(let e in t.BASKET_DATA.MUTATOR.PRODUCT_FIELDS)t.BASKET_DATA.MUTATOR.PRODUCT_FIELDS.hasOwnProperty(e)&&(s[e]=t.BASKET_DATA.MUTATOR.PRODUCT_FIELDS[e]);let r={};Object.keys(t.BASKET_DATA.GRID.ROWS).forEach((e=>{if(t.BASKET_DATA.GRID.ROWS.hasOwnProperty(e)){let a=t.BASKET_DATA.GRID.ROWS[e];r[a.PRODUCT_ID]=a.QUANTITY}}));let n={};"object"==typeof a&&(n=a),n.products_count=r,n.product_fields=s,n.modal_basket=i;let l=new CustomEvent("basket:onchange",{detail:n});document.dispatchEvent(l),BX.onCustomEvent("OnBasketChange")}static updateBasket(e={}){e="object"==typeof e?e:{},Basket$1.recalcBasketAjax(e)}static enterCoupon(){let e=BX("coupon");e&&e.value&&Basket$1.recalcBasketAjax({coupon:e.value})}static updateQuantity(e,t,a,o,s){let i=BX(e).defaultValue,r=parseFloat(BX(e).value)||0,n=!1,l=BX("auto_calculation")&&"Y"==BX("auto_calculation").value||!BX("auto_calculation");if(0===a||1==a)n=!0;else{0===1e4*r%(1e4*a)&&(n=!0)}let d=!1;parseInt(r)!=parseFloat(r)&&(d=!0),r=!1===o&&!1===d?parseInt(r):parseFloat(r).toFixed(4),r=Basket$1.correctQuantity(r);let c={product_id:document.querySelector('[data-cart-id="'+t+'"]').dataset.productId,basket_id:t};n?(BX(e).defaultValue=r,BX("QUANTITY_INPUT_"+t).value=r,BX("QUANTITY_"+t).value=r,l&&window.basketPoolQuantity.changeQuantity(c)):(r=Basket$1.getCorrectRatioQuantity(r,a,o),r=Basket$1.correctQuantity(r),r!=i?(BX("QUANTITY_INPUT_"+t).value=r,BX("QUANTITY_"+t).value=r,l&&window.basketPoolQuantity.changeQuantity(c)):BX(e).value=i)}static setQuantity(e,t,a,o){let s,i=parseFloat(BX("QUANTITY_INPUT_"+e).value);s="up"===a?i+t:i-t,s<0&&(s=0),o&&(s=parseFloat(s).toFixed(4)),s=Basket$1.correctQuantity(s),o||s==s.toFixed(4)||(s=parseFloat(s).toFixed(4)),s=Basket$1.getCorrectRatioQuantity(s,t,o),s=Basket$1.correctQuantity(s),BX("QUANTITY_INPUT_"+e).value=s,BX("QUANTITY_INPUT_"+e).defaultValue=s,Basket$1.updateQuantity("QUANTITY_INPUT_"+e,e,t,o,"up"===a)}static getCorrectRatioQuantity(e,t,a){let o,s=(e/t-(e/t).toFixed(0)).toFixed(6),i=e,r=!1;if(t=parseFloat(t),0==s)return i;if(0!==t&&1!=t)for(o=t,max=parseFloat(e)+parseFloat(t);o<=max;o=parseFloat(parseFloat(o)+parseFloat(t)).toFixed(4))i=o;else 1===t&&(i=0|e);return parseInt(i,10)!=parseFloat(i)&&(r=!0),i=!1===a&&!1===r?parseInt(i,10):parseFloat(i).toFixed(4),i=Basket$1.correctQuantity(i),i}static correctQuantity(e){return parseFloat((1*e).toString())}static recalcBasketAjax(e){if(window.basketPoolQuantity.isProcessing())return!1;let t,a,o=BX("action_var").value,s=BX("basket_items");t={sessid:BX.bitrix_sessid(),site_id:BX.message("SITE_ID"),props:{},action_var:o,select_props:BX("column_headers").value,quantity_float:BX("quantity_float").value,price_vat_show_value:BX("price_vat_show_value").value,hide_coupon:BX("hide_coupon").value,use_prepayment:BX("use_prepayment").value,template:window.basketJSParams.TEMPLATE},t[o]="recalculate";let i=!1;if(e&&"object"==typeof e)for(a in void 0!==e.extEventData&&(i=e.extEventData,delete e.extEventData),e)e.hasOwnProperty(a)&&(t[a]=e[a]);let r=s.querySelectorAll(".cart-item");e.counter&&r.length>0&&r.forEach((function(e){t["QUANTITY_"+e.dataset.cartId]=BX("QUANTITY_"+e.dataset.cartId).value})),window.basketPoolQuantity.setProcessing(!0),window.basketPoolQuantity.clearPool(),BX.ajax({url:"/bitrix/components/bitrix/sale.basket.basket/ajax.php",method:"POST",data:t,dataType:"json",onsuccess:function(t){if(window.basketPoolQuantity.setProcessing(!1),e.coupon&&(t&&t.BASKET_DATA&&t.BASKET_DATA.NEED_TO_RELOAD_FOR_GETTING_GIFTS&&BX.reload(),t&&t.BASKET_DATA&&t.BASKET_DATA.COUPON_LIST)){let a=null,o=t.BASKET_DATA.COUPON_LIST.filter((t=>t.COUPON===e.coupon));o.length>0&&(a=o[0]);let s="basket:coupon-"+(t.VALID_COUPON?"applied":"fail");a&&document.dispatchEvent(new CustomEvent(s,{detail:{coupon:a}}))}window.basketPoolQuantity.isPoolEmpty()?(Basket$1.updateBasketTable(null,t,i),window.basketPoolQuantity.updateQuantity()):window.basketPoolQuantity.enableTimer(!0)}})}static repeatOrder(e){BX.ajax({url:"/ajax/sale/basket/",method:"POST",data:{order_id:e,action:"repeatOrder"},dataType:"json",onsuccess:function(e){"OK"===e.STATUS?(Basket$1.updateBasket(),document.dispatchEvent(new CustomEvent("personal-order:repeat-success"))):document.dispatchEvent(new CustomEvent("personal-order:repeat-fail",{detail:{error:answer.MESSAGE}}))}})}}window.Basket=Basket$1,window.basketPoolQuantity=new BasketPoolQuantity,BX.namespace("BX.Sale.OrderAjaxComponent"),BX.Sale&&BX.Sale.Input&&BX.Sale.Input.Utils&&(BX.Sale.Input.Utils.asMultiple=function(e){if(null==e||""===e)return[];if(e.constructor===Array){for(var t,a=0,o=e.length;a<o;)null==(t=e[a])||""===t?(e.splice(a,1),--o):++a;return e.length?e:[""]}return[e]}),BX.Sale.OrderAjaxComponent={initializePrimaryFields:function(){this.BXFormPosting=!1,this.regionBlockNotEmpty=!1,this.locations={},this.cleanLocations={},this.locationsTemplate="",this.options={},this.activeSectionId="",this.firstLoad=!0,this.mapsReady=!1,this.lastSelectedDelivery=0,this.deliveryPagination={},this.paySystemPagination={},this.validation={},this.hasErrorSection={},this.pickUpPagination={},this.timeOut={},this.isMobile=BX.browser.IsMobile(),this.isHttps="https:"===window.location.protocol,this.orderSaveAllowed=!0,this.socServiceHiddenNode=!1},init:function(e){this.initializePrimaryFields(),this.result=e.result||{},this.params=e.params||{},this.signedParamsString=e.signedParamsString||"",this.siteId=e.siteID||"",this.ajaxUrl=e.ajaxUrl||"",this.templateFolder=e.templateFolder||"",this.defaultBasketItemLogo=this.templateFolder+"/images/product_logo.png",this.defaultStoreLogo=this.templateFolder+"/images/pickup_logo.png",this.defaultDeliveryLogo=this.templateFolder+"/images/delivery_logo.png",this.defaultPaySystemLogo=this.templateFolder+"/images/pay_system_logo.png",this.totalBlockNode=BX(e.totalBlockId),this.mobileTotalBlockNode=BX(e.totalBlockId+"-mobile"),this.orderSaveBlockNode=BX("bx-soa-orderSave"),this.mainErrorsNode=BX("bx-soa-main-notifications"),this.mainRows=BX("bx-soa-rows"),this.deliveryRows=BX("bx-soa-delivery-rows"),this.orderBlockNode=BX(e.orderBlockId),this.authBlockNode=BX(e.authBlockId),this.authHiddenBlockNode=BX(e.authBlockId+"-hidden"),this.basketBlockNode=BX(e.basketBlockId),this.basketHiddenBlockNode=BX(e.basketBlockId+"-hidden"),this.regionBlockNode=BX(e.regionBlockId),this.regionHiddenBlockNode=BX(e.regionBlockId+"-hidden"),this.paySystemBlockNode=BX(e.paySystemBlockId),this.paySystemHiddenBlockNode=BX(e.paySystemBlockId+"-hidden"),this.deliveryBlockNode=BX(e.deliveryBlockId),this.deliveryHiddenBlockNode=BX(e.deliveryBlockId+"-hidden"),this.pickUpBlockNode=BX(e.pickUpBlockId),this.pickUpHiddenBlockNode=BX(e.pickUpBlockId+"-hidden"),this.propsBlockNode=BX(e.propsBlockId),this.propsHiddenBlockNode=BX(e.propsBlockId+"-hidden"),this.orderSubmitButtons=document.querySelectorAll(".js-order-submit-btn"),this.suggestionsToken=e.suggestionsToken,this.result.SHOW_AUTH&&(this.authBlockNode.style.display="",BX.addClass(this.authBlockNode,"bx-active"),this.authGenerateUser="Y"!==this.result.AUTH.new_user_registration_email_confirmation&&"Y"!==this.result.AUTH.new_user_phone_required),this.totalBlockNode&&(this.totalInfoBlockNode=this.totalBlockNode.querySelector(".bx-soa-cart-total"));let t=document.querySelector("#ORDER_LOCATION");t&&t.addEventListener("change",ItsUtils.debounce((e=>{this.sendRequest()}),700)),this.options.totalPriceChanged=!1,this.editOrder(),"Y"===this.params.USER_CONSENT&&this.initUserConsent(),document.dispatchEvent(new CustomEvent("soa:component.inited",{detail:{component:this}}))},refreshOrder:function(e){return e.error?this.showError(e.error):e.order.SHOW_AUTH?(BX.merge(this.result,e.order),this.showErrors(e.order.ERROR,!1)):(this.isPriceChanged(e),this.result=e.order,this.editOrder(),BX.saleOrderAjax&&BX.saleOrderAjax.initDeferredControl()),!0},editOrder:function(){this.orderBlockNode&&this.result&&(this.refreshDeliveries(),this.editTotalBlock(),this.showErrors(this.result.ERROR,!1))},showError:function(e){BX.type.isArray(e)&&(e=e.join("<br>")),e.length&&document.dispatchEvent(new CustomEvent("soa:component.error",{detail:{message:e}}))},showErrors:function(e,t){if(e&&!(BX.util.object_keys(e).length<1))for(let a in e){if(!e.hasOwnProperty(a))continue;let o=e[a];switch(a.toUpperCase()){case"MAIN":this.showError(o);break;case"AUTH":this.authBlockNode&&this.authBlockNode.style.display,this.showError(o);break;case"REGION":(t||"true"===this.regionBlockNode.getAttribute("data-visited"))&&(this.showError(o),this.showError(o));break;case"DELIVERY":(t||"true"===this.deliveryBlockNode.getAttribute("data-visited"))&&(this.showError(o),this.showError(o));break;case"PAY_SYSTEM":(t||"true"===this.paySystemBlockNode.getAttribute("data-visited"))&&(this.showError(o),this.showError(o));break;case"PROPERTY":(t||"true"===this.propsBlockNode.getAttribute("data-visited"))&&(this.showError(o),this.showError(o))}}},sendRequest:function(e,t){let a;this.firstLoad=!1,e=BX.type.isNotEmptyString(e)?e:"refreshOrderAjax",this.disableSubmitButtons(),"saveOrderAjax"===e?(a=BX("bx-soa-order-form"),a&&(a.querySelector("input[type=hidden][name=sessid]").value=BX.bitrix_sessid()),BX.ajax.submitAjax(BX("bx-soa-order-form"),{url:this.ajaxUrl,method:"POST",dataType:"json",data:{via_ajax:"Y",action:"saveOrderAjax",sessid:BX.bitrix_sessid(),SITE_ID:this.siteId,signedParamsString:this.signedParamsString},onsuccess:BX.proxy(this.saveOrderWithJson,this),onfailure:BX.proxy(this.handleNotRedirected,this)})):BX.ajax({method:"POST",dataType:"json",url:this.ajaxUrl,data:this.getData(e,t),onsuccess:BX.delegate((function(t){switch(t.redirect&&t.redirect.length&&(document.location.href=t.redirect),e){case"refreshOrderAjax":this.refreshOrder(t);break;case"confirmSmsCode":case"showAuthForm":this.firstLoad=!0,this.refreshOrder(t)}this.enableSubmitButtons()}),this),onfailure:BX.delegate((function(){this.enableSubmitButtons()}),this)})},saveOrderWithJson:function(e){this.enableSubmitButtons(),e&&e.order&&((e=e.order).ID&&(this.disallowOrderSave(),document.dispatchEvent(new CustomEvent("soa:component.order-saved",{detail:{id:e.ID,params:this.params}}))),e.SHOW_AUTH?(this.result.SHOW_AUTH=e.SHOW_AUTH,this.result.AUTH=e.AUTH,this.result.SMS_AUTH=e.SMS_AUTH):this.showErrors(e.ERROR,!0,!0))},getData:function(e,t){var a={order:this.getAllFormData(),sessid:BX.bitrix_sessid(),via_ajax:"Y",SITE_ID:this.siteId,signedParamsString:this.signedParamsString};return a[this.params.ACTION_VARIABLE]=e,a},getAllFormData:function(){var e,t=BX("bx-soa-order-form"),a=BX.ajax.prepareForm(t);for(e in a.data)a.data.hasOwnProperty(e)&&""==e&&delete a.data[e];return a&&a.data?a.data:{}},doSaveAction:function(){this.isOrderSaveAllowed()&&this.sendRequest("saveOrderAjax")},activatePhoneAuth:function(){this.result.SMS_AUTH&&new BX.PhoneAuth({containerId:"bx_register_resend",errorContainerId:"bx_register_error",interval:60,data:{signedData:this.result.SMS_AUTH.SIGNED_DATA},onError:function(e){var t=BX("bx_register_error"),a=BX.findChildByClassName(t,"errortext");a.innerHTML="";for(var o=0;o<e.errors.length;o++)a.innerHTML=a.innerHTML+BX.util.htmlspecialchars(e.errors[o].message)+"<br>";t.style.display=""}})},popupShow:function(e,t,a){this.popup&&this.popup.destroy();var o=this;this.popup=new BX.PopupWindow("bx-soa-image-popup",null,{lightShadow:!0,offsetTop:0,offsetLeft:0,closeIcon:{top:"3px",right:"10px"},autoHide:!0,bindOptions:{position:"bottom"},closeByEsc:!0,zIndex:100,events:{onPopupShow:function(){BX.create("IMG",{props:{src:a||t},events:{load:function(){var e=BX("bx-soa-image-popup-content");if(e){var t,a,s=BX.GetWindowInnerSize(),i=this.isMobile?.5:.9;BX.cleanNode(e),e.appendChild(this),t=e.offsetHeight,a=e.offsetWidth,t>s.innerHeight*i&&(e.style.height=s.innerHeight*i+"px",e.style.width=a*(s.innerHeight*i/t)+"px",t=e.offsetHeight,a=e.offsetWidth),a>s.innerWidth*i&&(e.style.width=s.innerWidth*i+"px",e.style.height=t*(s.innerWidth*i/a)+"px"),e.style.height=e.offsetHeight+"px",e.style.width=e.offsetWidth+"px",o.popup.adjustPosition()}}}})},onPopupClose:function(){this.destroy()}},content:BX.create("DIV",{props:{id:"bx-soa-image-popup-content"},children:[BX.create("IMG",{props:{src:this.templateFolder+"/images/loader.gif"}})]})}),this.popup.show()},getCouponsList:function(e){let t,a=[];for(t=0;t<this.result.COUPON_LIST.length;t++)(e||!e&&"APPLIED"===this.result.COUPON_LIST[t].JS_STATUS)&&a.push(this.getCouponNode({text:this.result.COUPON_LIST[t].COUPON,desc:this.result.COUPON_LIST[t].JS_CHECK_CODE,status:this.result.COUPON_LIST[t].JS_STATUS},e));return a},editTotalBlock:function(){if(!this.totalInfoBlockNode||!this.result.TOTAL)return;var e,t,a,o,s=this.result.TOTAL,i={};this.params.SHOW_TOTAL_ORDER_BUTTON;let r=this.result.PAY_SYSTEM?this.result.PAY_SYSTEM.filter((e=>"Y"===e.CHECKED)):[];r=r.length>0?r[0]:null;let n=BX.message("ORDER_DEFAULT");r&&"Y"!==r.IS_CASH&&(n=BX.message("SOA_PAY_NOW_BTN")),this.orderSubmitButtons.forEach((e=>{e.innerText=n}));let l={orderDiscounted:{formatted:s.ORDER_PRICE_FORMATED,raw:s.ORDER_PRICE},order:{formatted:s.PRICE_WITHOUT_DISCOUNT,raw:s.PRICE_WITHOUT_DISCOUNT_VALUE},delivery:{formatted:parseFloat(s.DELIVERY_PRICE)>0?s.DELIVERY_PRICE_FORMATED:BX.message("PRICE_FREE_DEFAULT"),raw:s.DELIVERY_PRICE},deliveryDiscount:{formatted:"",raw:0},discount:{formatted:s.DISCOUNT_PRICE_FORMATED,raw:s.DISCOUNT_PRICE},orderDiscountedDelivered:{formatted:s.ORDER_TOTAL_PRICE_FORMATED,raw:s.ORDER_TOTAL_PRICE}};for(e in i={},(a=(t=this.getSelectedDelivery())&&t.CALCULATE_ERRORS&&t.CALCULATE_ERRORS.length)?(o=BX.message("SOA_NOT_CALCULATED"),i.error=a,l.delivery.raw=0,l.delivery.formatted=o):t&&void 0!==t.DELIVERY_DISCOUNT_PRICE&&parseFloat(t.PRICE)>parseFloat(t.DELIVERY_DISCOUNT_PRICE)&&(l.deliveryDiscount.raw=parseFloat(t.DELIVERY_DISCOUNT_PRICE),l.deliveryDiscount.formatted=t.DELIVERY_DISCOUNT_PRICE_FORMATED),this.result.DELIVERY)this.result.DELIVERY[e].CHECKED&&(l.deliveryHint=this.result.DELIVERY[e].DELIVERY_HINT);document.dispatchEvent(new CustomEvent("soa:component.total-update",{detail:l}))},getSelectedDelivery:function(){var e,t,a=this.deliveryBlockNode.querySelector("input[type=checkbox][name=DELIVERY_ID]:checked"),o=!1;if(a)for(t in e=a.value,this.result.DELIVERY)if(this.result.DELIVERY[t].ID===e){o=this.result.DELIVERY[t];break}return o},refreshDeliveries(){if(window.deliveryTemplate){this.deliveryRows.innerHTML="";for(let e in this.result.DELIVERY)if(this.result.DELIVERY.hasOwnProperty(e)){let t=this.result.DELIVERY[e],a=t.hasOwnProperty("PRICE")&&t.PRICE>0&&t.PRICE?t.PRICE_FORMATED:BX.message("PRICE_FREE_DEFAULT"),o=t.DESCRIPTION.indexOf("##HINT##");t.DELIVERY_HINT="",o>0&&(t.DELIVERY_HINT=t.DESCRIPTION.substring(o+8),t.DESCRIPTION=t.DESCRIPTION.substring(0,o));let s=ItsUtils.replaceArrays(window.deliveryTemplate,["{checked}","{id}","{name}","{description}","{cost}"],["Y"===t.CHECKED?'checked="checked"':"",t.ID,t.NAME,t.DESCRIPTION,a]);this.deliveryRows.insertAdjacentHTML("beforeend",s)}}},isOrderSaveAllowed:function(){return!0===this.orderSaveAllowed},allowOrderSave:function(){this.orderSaveAllowed=!0},disallowOrderSave:function(){this.orderSaveAllowed=!1,this.orderSubmitButtons.forEach((e=>{e.parentNode.removeChild(e)}))},handleNotRedirected:function(){this.enableSubmitButtons()},isPriceChanged:function(e){let t=null===this.result.TOTAL.ORDER_TOTAL_LEFT_TO_PAY||""===this.result.TOTAL.ORDER_TOTAL_LEFT_TO_PAY?this.result.TOTAL.ORDER_TOTAL_PRICE:this.result.TOTAL.ORDER_TOTAL_LEFT_TO_PAY,a=null===e.order.TOTAL.ORDER_TOTAL_LEFT_TO_PAY?e.order.TOTAL.ORDER_TOTAL_PRICE:e.order.TOTAL.ORDER_TOTAL_LEFT_TO_PAY;this.options.totalPriceChanged=parseFloat(t)!=parseFloat(a)},initUserConsent:function(){BX.ready(BX.delegate((function(){var e=BX.UserConsent&&BX.UserConsent.load(this.orderBlockNode);e&&(BX.addCustomEvent(e,BX.UserConsent.events.save,BX.proxy(this.doSaveAction,this)),BX.addCustomEvent(e,BX.UserConsent.events.refused,BX.proxy(this.disallowOrderSave,this)))}),this))},enableSubmitButtons(){this.orderSubmitButtons.forEach((e=>{e.disabled=!1}))},disableSubmitButtons(){this.orderSubmitButtons.forEach((e=>{e.disabled=!0}))}},BX.saleOrderAjax={BXCallAllowed:!1,options:{},indexCache:{},controls:{},modes:{},properties:{},init:function(e){var t=this;this.options=e,window.submitFormProxy=BX.proxy((function(){t.submitFormProxy.apply(t,arguments)}),this),BX((function(){t.initDeferredControl()})),BX((function(){t.BXCallAllowed=!0})),this.controls.scope=BX("bx-soa-order"),BX.bindDelegate(this.controls.scope,"click",{className:"-bx-popup-set-mode-add-loc"},(function(){var e=BX.create("input",{attrs:{type:"hidden",name:"PERMANENT_MODE_STEPS",value:"1"}});BX.prepend(e,BX("bx-soa-order")),t.BXCallAllowed=!1,BX.Sale.OrderAjaxComponent.sendRequest()})),document.addEventListener("basket:onchange",(e=>{BX.Sale.OrderAjaxComponent.sendRequest()}))},cleanUp:function(){for(var e in this.properties)this.properties.hasOwnProperty(e)&&(void 0!==this.properties[e].input&&(BX.unbindAll(this.properties[e].input),this.properties[e].input=null),void 0!==this.properties[e].control&&BX.unbindAll(this.properties[e].control));this.properties={}},initDeferredControl:function(){var e,t,a,o,s,i=this;if(void 0!==window.BX.locationsDeferred)for(e in this.BXCallAllowed=!1,window.BX.locationsDeferred)window.BX.locationsDeferred[e].call(this),window.BX.locationsDeferred[e]=null,delete window.BX.locationsDeferred[e],this.properties[e].control=window.BX.locationSelectors[e],delete window.BX.locationSelectors[e];for(e in this.properties)if(this.properties[e].isZip&&(t=this.controls.scope.querySelector('[data-property-id-row="'+e+'"]'),BX.type.isElementNode(t)&&(a=t.querySelector('input[type="text"]'),BX.type.isElementNode(a)))){for(s in this.properties[e].input=a,o=!1,this.properties)if("LOCATION"==this.properties[s].type){o=s;break}!1!==o&&BX.bindDebouncedChange(a,(function(e){var s=BX("ZIP_PROPERTY_CHANGED");s&&(s.value="Y"),a=null,t=null,BX.type.isNotEmptyString(e)&&/^\s*\d+\s*$/.test(e)&&e.length>3&&i.getLocationsByZip(e,(function(e){i.properties[o].control.setValueByLocationIds(e)}),(function(){}))}))}this.BXCallAllowed=!0},checkMode:function(e,t){if("altLocationChoosen"==t&&this.checkAbility(e,"canHaveAltLocation")){var a=this.getInputByPropId(this.properties[e].altLocationPropId),o=this.properties[e].altLocationPropId;if(!1!==a&&a.value.length>0&&!a.disabled&&"default"!=this.properties[o].valueSource)return!0}return!1},checkAbility:function(e,t){if(void 0===this.properties[e]&&(this.properties[e]={}),void 0===this.properties[e].abilities&&(this.properties[e].abilities={}),void 0!==this.properties[e].abilities&&this.properties[e].abilities[t])return!0;if("canHaveAltLocation"==t&&"LOCATION"==this.properties[e].type&&void 0!==this.properties[e].altLocationPropId&&(this.properties[this.properties[e].altLocationPropId],1)){var a=this.properties[e].altLocationPropId;if(void 0!==this.properties[e].control&&"slst"==this.properties[e].control.getSysCode()&&!1!==this.getInputByPropId(a))return this.properties[e].abilities[t]=!0,!0}return!1},getInputByPropId:function(e){if(void 0!==this.properties[e].input)return this.properties[e].input;var t=this.getRowByPropId(e);if(BX.type.isElementNode(t)){var a=t.querySelector('input[type="text"]');if(BX.type.isElementNode(a))return this.properties[e].input=a,a}return!1},getRowByPropId:function(e){if(void 0!==this.properties[e].row)return this.properties[e].row;var t=this.controls.scope.querySelector('[data-property-id-row="'+e+'"]');return!!BX.type.isElementNode(t)&&(this.properties[e].row=t,t)},getAltLocPropByRealLocProp:function(e){return void 0!==this.properties[e].altLocationPropId&&this.properties[this.properties[e].altLocationPropId]},toggleProperty:function(e,t,a){var o=this.properties[e];void 0===o.row&&(o.row=this.getRowByPropId(e)),void 0===o.input&&(o.input=this.getInputByPropId(e)),t?(a||BX.show(o.row),o.input.disabled=!1):(a||BX.hide(o.row),o.input.disabled=!0)},submitFormProxy:function(e,t){for(var a in this.properties)if(void 0!==this.properties[a].control&&this.properties[a].control==t)break;"other"!=e&&this.BXCallAllowed&&(this.BXCallAllowed=!1,setTimeout((function(){BX.Sale.OrderAjaxComponent.sendRequest()}),20))},getPreviousAdapterSelectedNode:function(e,t){var a=t.getIndex(),o=e.getAdapterAtPosition(a-1);if(void 0!==o&&null!=o){var s=o.getControl().getValue();if(void 0!==s){var i=e.getNodeByValue(s);return void 0!==i&&i}}return!1},getLocationsByZip:function(e,t,a){if(void 0===this.indexCache[e]){var o=this;BX.ajax({url:this.options.source,method:"post",dataType:"json",async:!0,processData:!0,emulateOnload:!0,start:!0,data:{ACT:"GET_LOCS_BY_ZIP",ZIP:e},onsuccess:function(s){s.result?(o.indexCache[e]=s.data,t.apply(o,[s.data])):a.call(o)},onfailure:function(e,t){}})}else t.apply(this,[this.indexCache[e]])}},document.addEventListener("soa:component.total-update",(e=>{BX("js-order-sum")&&(BX("js-order-sum").innerHTML=e.detail.order.formatted),BX("js-order-delivery")&&(BX("js-order-delivery").innerHTML=e.detail.delivery.formatted),BX("js-order-discount")&&(BX("js-order-discount").innerHTML=e.detail.discount.formatted),BX("js-order-final")&&(BX("js-order-final").innerHTML=e.detail.orderDiscountedDelivered.formatted),BX("js-order-sum-mobile")&&(BX("js-order-sum-mobile").innerHTML=e.detail.order.formatted),BX("js-order-delivery-mobile")&&(BX("js-order-delivery-mobile").innerHTML=e.detail.delivery.formatted),BX("js-order-discount-mobile")&&(BX("js-order-discount-mobile").innerHTML=e.detail.discount.formatted),BX("js-order-final-mobile")&&(BX("js-order-final-mobile").innerHTML=e.detail.orderDiscountedDelivered.formatted),BX("js-delivery-hint")&&BX.adjust(BX("js-delivery-hint"),{attrs:{"data-content":e.detail.deliveryHint}})})),document.addEventListener("soa:component.inited",(e=>{let t=e.detail.component,a=t.mainRows.querySelector('[data-address="DELIVERY_ADDR"]'),o=document.querySelector("#ORDER_LOCATION");if(a&&o){$(a).suggestions({token:t.suggestionsToken,type:"ADDRESS",onSelect:function(e){if(!e.data)return;let a=t.mainRows.querySelector('[data-code="DELIVERY_STREET"]'),s=t.mainRows.querySelector('[data-code="DELIVERY_HOUSE"]'),i=t.mainRows.querySelector('[data-code="DELIVERY_FLAT"]'),r=t.mainRows.querySelector('[data-code="ORDER_LOCATION_COORD"]');a&&(a.value=e.data.street),s&&(s.value=e.data.house),i&&(i.value=e.data.flat),r&&e.data.geo_lat&&e.data.geo_lon&&(r.value=`${e.data.geo_lat},${e.data.geo_lon}`),$.ajax({url:"/ajax/sale/geo/bx_location_code/",type:"post",data:{dadata_array:e.data},success:function(t){t.success?(o.value=t.data.location_code,o.dispatchEvent(new Event("change"))):(BX.Sale.OrderAjaxComponent.sendRequest(),document.dispatchEvent(new CustomEvent("soa:failed-location-response",{detail:{suggestion_data:e,response:t}})))}})}}).suggestions().fixData()}}));var baseGoalsToReal={contacts_send:{page:"",realGoals:{google:{name:"contacts_send"},metrika:{name:"contacts_send"}}},rassilka_send:{page:"",realGoals:{google:{name:"rassilka_send"},metrika:{name:"rassilka_send"}}},oneclick_click:{page:"",realGoals:{google:{name:"oneclick_click"},metrika:{name:"oneclick_click"}}},oneclick_send:{page:"",realGoals:{google:{name:"oneclick_send"},metrika:{name:"oneclick_send"}}},korzina:{page:"",realGoals:{google:{name:"korzina"},metrika:{name:"korzina"}}},zakaz_send:{page:"",realGoals:{google:{name:"zakaz_send"},metrika:{name:"zakaz_send"}}},korzina_perehod:{page:"",realGoals:{google:{name:"korzina_perehod"},metrika:{name:"korzina_perehod"}}},korzina_oform:{page:"",realGoals:{google:{name:"korzina_oform"},metrika:{name:"korzina_oform"}}},korzina_oform2:{page:"",realGoals:{google:{name:"korzina_oform2"},metrika:{name:"korzina_oform2"}}},izbran_click:{page:"",realGoals:{google:{name:"izbran_click"},metrika:{name:"izbran_click"}}},sravn_click:{page:"",realGoals:{google:{name:"sravn_click"},metrika:{name:"sravn_click"}}},akk:{page:"",realGoals:{google:{name:"akk"},metrika:{name:"akk"}}},akk_vhod:{page:"",realGoals:{google:{name:"akk_vhod"},metrika:{name:"akk_vhod"}}},akk_create:{page:"",realGoals:{google:{name:"akk_create"},metrika:{name:"akk_create"}}},akk_reg:{page:"",realGoals:{google:{name:"akk_reg"},metrika:{name:"akk_reg"}}},low_price_click:{page:"",realGoals:{google:{name:"low_price_click"},metrika:{name:"low_price_click"}}},low_price_send:{page:"",realGoals:{google:{name:"low_price_send"},metrika:{name:"low_price_send"}}},nalichie_click:{page:"",realGoals:{google:{name:"nalichie_click"},metrika:{name:"nalichie_click"}}},nalichie_send:{page:"",realGoals:{google:{name:"nalichie_send"},metrika:{name:"nalichie_send"}}},email_click:{page:"",realGoals:{google:{name:"email_click"},metrika:{name:"email_click"}}}},goalsSender=(getLastTriggeredBaseGoal=function(){return triggeredBaseEvents.slice(-1)[0]},addGoaltoActiveList=function(e){triggeredBaseEvents.push(e)},getEventByDependiens=function(e){var t;return"string"==typeof(t=getLastTriggeredBaseGoal())&&"object"==typeof e.dependiens&&"string"==typeof e.dependiens[t]&&e.dependiens[t]},pushGoal=function(e,t){if("function"!=typeof providers[e])return!1;providers[e](t)},registerEvent=function(e){e.data("is-goal"),e.on("click.metrics",(function(){var e,t=$(this).data("base-goal-name");for(var a in e=getRealGoals(t)){var o;o=getEventByDependiens(e[a]),pushGoal(a,o||e[a].name)}addGoaltoActiveList(t)}))},getRealGoals=function(e){return void 0!==goalsToReal[e]&&"object"==typeof goalsToReal[e].realGoals&&goalsToReal[e].realGoals},{init:function(e){goalsToReal=e,triggeredBaseEvents=[],providers={metrika:function(e){"function"==typeof ym&&ym(71527723,"reachGoal",e),console.log("metrika-fire"),console.log(e)},google:function(e){"function"==typeof gtag&&gtag("event",e),console.log("google-fire"),console.log(e)}}},registerEvent:registerEvent}),goalsToReal,providers,triggeredBaseEvents,registerEvent,getRealGoals,pushGoal,addGoaltoActiveList,getLastTriggeredBaseGoal,getEventByDependiens,sendMetricGoals=function(){goalsSender.init(baseGoalsToReal),$("*[data-is-goal]").unbind("click.metrics"),$("*[data-is-goal]").each((function(){goalsSender.registerEvent($(this))}))};$(document).ready(sendMetricGoals),document.addEventListener("swup: contentReplaced",sendMetricGoals);class SendForm{constructor(e){this.initForm(e),this.fd=this.getFormData(e),this.sendData(this.fd)}initForm(e){this.form=e}success(response){let ev;response=JSON.parse(response),response.success?(ev=new CustomEvent("onSuccessFormSubmit",{detail:{message:response.message,form:this.form},bubbles:!0}),this.clearForm(this.form)):ev=new CustomEvent("onErrorFormSubmit",{detail:{message:response.error,form:this.form},bubbles:!0}),this.form.dispatchEvent(ev),"object"==typeof response.data&&response.data.refresh_recaptcha&&eval(response.data.refresh_recaptcha)}sendData(e){BX.ajax({url:e.form.attributes.action.value,method:e.form.attributes.method.value,processData:!1,data:e.data,preparePost:!1,onsuccess:this.success.bind(this),onfailure:function(){console.log("Internal Server Error")}})}getFormData(e,t){t=!!t;let a=new FormData(e),o=!!e.querySelector('input[type="file"]');if(o&&"object"==typeof validatedFiles){let o=e.querySelector('input[type="file"]'),s=validatedFiles,i=this.checkMultiFileName(o.name)?o.name:o.name+"[]",r=this.checkMultiFileName(o.name)?o.name.substring(0,o.name.length-2):o.name;for(let e=0;e<s.length;e++)a.append(i,s[e]),t&&a.append(r+"["+e+"][ID]","")}return{files:o,form:e,data:a}}checkMultiFileName(e){return-1!==e.indexOf("[]")&&e.indexOf("[]")===e.length-2}clearForm(e){["textarea",'input[type="text"]','input[type="password"]','input[type="tel"]','input[type="email"]','input[type="file"]','input[type="checkbox"]','input[type="radio"]'].forEach((t=>{Array.from(e.querySelectorAll(t)).forEach((e=>{switch(e.type){case"checkbox":case"radio":e.checked=!1;break;default:e.value="",e.dispatchEvent(new CustomEvent("keyup",{bubbles:!0}))}}))}))}}class ProductForm extends SendForm{initForm(e){super.initForm(e);let t=this.form.querySelector("[data-product-id-field]"),a=document.querySelector("[data-product-page]");a&&t&&(t.value=a.dataset.productId)}}class AuthForm extends SendForm{success(response){let ev;response=JSON.parse(response),response.success?(ev=new CustomEvent("iblock-form:auth-success",{detail:{message:response.message,form:this.form},bubbles:!0}),this.clearForm(this.form)):ev=new CustomEvent("iblock-form:auth-fail",{detail:{message:response.message,form:this.form},bubbles:!0}),document.dispatchEvent(ev),"object"==typeof response.data&&response.data.refresh_recaptcha&&eval(response.data.refresh_recaptcha)}}class ProfileForm extends SendForm{success(response){let ev;response=JSON.parse(response),response.success?(ev=new CustomEvent("profile-form:save-success",{detail:{message:response.message,form:this.form},bubbles:!0}),this.clearForm(this.form)):ev=new CustomEvent("profile-form:save-fail",{detail:{message:response.message,form:this.form},bubbles:!0}),document.dispatchEvent(ev),"object"==typeof response.data&&response.data.refresh_recaptcha&&eval(response.data.refresh_recaptcha)}}class RegisterForm extends SendForm{success(response){let ev;response=JSON.parse(response);let detail={message:response.message,form:this.form,data:response.data?response.data:{}};ev=response.success?new CustomEvent("iblock-form:register-success",{detail:detail,bubbles:!0}):new CustomEvent("iblock-form:register-fail",{detail:detail,bubbles:!0}),document.dispatchEvent(ev),"object"==typeof response.data&&response.data.refresh_recaptcha&&eval(response.data.refresh_recaptcha)}}function JCSmartFilter(e,t){this.ajaxURL=e,this.form=document.querySelector(".modal .modal__filters"),this.timer=null,this.cacheKey="",this.cache=[],this.viewMode=t,this.modef=BX("modef"),this.panelBtns=document.querySelectorAll(".set_filter"),this.init()}function productAction(e,t,a=1){$.ajax({url:"/ajax/sale/basket/",type:"post",data:{action:e,id:t,quantity:a},dataType:"json",success:function(a){let o,s={after:e,data:"object"==typeof a.DATA?a.DATA:{}};"OK"===a.STATUS?("object"==typeof a.REFRESH_BASKET&&(s.refresh_basket=!!a.REFRESH_BASKET),t&&(s.product_id=t),"object"==typeof a.EXISTING_PRODUCTS&&(s.products_count=a.EXISTING_PRODUCTS),o=new CustomEvent("onBasketStateChanged",{detail:s})):(s.message=a.MESSAGE,o=new CustomEvent("onFailBasketChanged",{detail:s})),document.dispatchEvent(o)},error:function(){document.dispatchEvent(new CustomEvent("onFailBasketChanged",{detail:{after:e,message:"Internal Server Error"}}))}})}JCSmartFilter.controlsInited=!1,JCSmartFilter.prototype.init=function(e){JCSmartFilter.controlsInited||($(document).on("click",".set_filter",(function(e){if(this.dataset.link.length){let e=new CustomEvent("pageToLoadUrl",{detail:{url:this.dataset.link}});document.dispatchEvent(e)}else window.modal.closeActiveModals()})),JCSmartFilter.controlsInited=!0)},JCSmartFilter.prototype.keyup=function(e,t=!1){t=!!t,this.timer&&clearTimeout(this.timer),this.timer=setTimeout(BX.delegate((function(){this.reload(e,t)}),this),500)},JCSmartFilter.prototype.click=function(e,t=!1){t=!!t,this.timer&&clearTimeout(this.timer),this.timer=setTimeout(BX.delegate((function(){this.reload(e,t)}),this),500)},JCSmartFilter.prototype.reload=function(e,t=!1){if(""!==this.cacheKey)return this.timer&&clearTimeout(this.timer),void(this.timer=setTimeout(BX.delegate((function(){this.reload(e)}),this),1e3));if(this.cacheKey="|",this.form){var a=[];a[0]={name:"ajax",value:"y"},this.gatherInputsValues(a,BX.findChildren(this.form,{tag:new RegExp("^(input|select)$","i")},!0));for(var o=0;o<a.length;o++)this.cacheKey+=a[o].name+":"+a[o].value+"|";let s={el:e},i=new Event("Event");i.initEvent("onFilterRequestStarted"),document.dispatchEvent(i),this.cache[this.cacheKey]?this.postHandler(this.cache[this.cacheKey],!0,t,s):BX.ajax.loadJSON(this.ajaxURL,this.values2post(a),BX.delegate((function(e){this.postHandler(e,!1,t,s)}),this))}},JCSmartFilter.prototype.postHandler=function(e,t,a,o){BX("modef_num");if(e&&e.ITEMS){let t={},r={};for(var s in e.ITEMS)if(e.ITEMS.hasOwnProperty(s))for(var i in e.ITEMS[s].VALUES)if(e.ITEMS[s].VALUES.hasOwnProperty(i)){let a=e.ITEMS[s].VALUES[i];void 0!==a.ELEMENT_COUNT&&(t[a.CONTROL_ID]=a.ELEMENT_COUNT),"MAX"!==i&&"MIN"!==i||(r[a.CONTROL_ID]=a.FILTERED_VALUE?a.FILTERED_VALUE:a.VALUE)}if(this.modef&&o){let s=new CustomEvent("onFilterRequestCompleted",{detail:{foundCount:e.ELEMENT_COUNT,btnText:e.ELEMENT_COUNT+" "+ItsUtils.Declension(e.ELEMENT_COUNT,"товар","товара","товаров"),resultsUrl:BX.util.htmlspecialcharsback(e.FILTER_URL),instantReload:a,dataset:o.el.dataset,checkboxNum:t,ranges:Object.values(r).length?r:null}});document.dispatchEvent(s)}}t||""===this.cacheKey||(this.cache[this.cacheKey]=e),this.cacheKey=""},JCSmartFilter.prototype.gatherInputsValues=function(e,t){if(t)for(var a=0;a<t.length;a++){var o=t[a];if(!o.disabled&&o.type)switch(o.type.toLowerCase()){case"text":case"number":case"textarea":case"password":case"hidden":case"select-one":o.value.length&&(e[e.length]={name:o.name,value:o.value});break;case"radio":case"checkbox":o.checked&&(e[e.length]={name:o.name,value:o.value});break;case"select-multiple":for(var s=0;s<o.options.length;s++)o.options[s].selected&&(e[e.length]={name:o.name,value:o.options[s].value})}}},JCSmartFilter.prototype.values2post=function(e){for(var t=[],a=t,o=0;o<e.length;){var s=e[o].name.indexOf("[");if(-1==s)a[e[o].name]=e[o].value,a=t,o++;else{var i=e[o].name.substring(0,s),r=e[o].name.substring(s+1);a[i]||(a[i]=[]);var n=r.indexOf("]");-1==n?(a=t,o++):0==n?(a=a[i],e[o].name=""+a.length):(a=a[i],e[o].name=r.substring(0,n)+r.substring(n+1))}}return t},document.addEventListener("catalog-filters:init",(function(e){window.smartFilter=new JCSmartFilter(location.pathname,"vertical")})),document.addEventListener("pageLoaded",(e=>{document.dispatchEvent(new CustomEvent("deferred-load:force",{}))})),document.addEventListener("onBasketStateChanged",(function(e){Basket.updateBasket({extEventData:e.detail})})),document.addEventListener("soa:component.init",(function(e){BX.Sale.OrderAjaxComponent.init(e.detail)})),document.addEventListener("soa:component.order-saved",(function(e){if(e.detail.params){let t=e.detail.params.PATH_TO_DETAIL.replace("#id#",e.detail.id);loadAndReplace(t,"#modalNewOrder",(()=>{document.querySelector("#modalNewOrder")&&window.showModal("#modalNewOrder")}),!1)}})),document.addEventListener("iblock-form:auth-success",(function(e){let t=e.detail&&e.detail.form?e.detail.form:null;if(t){let e=t.querySelector('input[name="backurl"]');e&&e.value.length>0&&(location.href=e.value)}})),document.addEventListener("iblock-form:register-success",(function(e){showModal("#modalRegistrationDone")})),$(document).on("click",".js__product-action",(e=>{e.preventDefault();let t=e.target.dataset.product,a=e.target.dataset.action,o=e.target.dataset.quantity>0?e.target.dataset.quantity:1;a&&productAction(a,t,o)})),$(document).on("submit",".js__searchline",(function(e){e.preventDefault(),this.searchline.value&&window.goToPage(this.action+BX.util.urlencode(this.searchline.value)+"/")})),$(document).on("submit",".js__send-ajax",(e=>{e.preventDefault(),new SendForm(e.target)})),$(document).on("submit",".js__ajax-auth",(e=>{e.preventDefault();for(var t=document.querySelectorAll(".modal__form-login .input"),a=!0,o=0;o<t.length;o++)t[o].value||(a=!1,t[o].classList.add("input--invalid"));a&&new AuthForm(e.target)})),$(document).on("submit",".js__ajax-register",(e=>{e.preventDefault();for(var t=document.querySelectorAll(".modal__form-registration .input"),a=!0,o=0;o<t.length;o++)t[o].classList.remove("input--invalid"),t[o].value&&void 0===t[o].dataset.invalid||(a=!1,t[o].classList.add("input--invalid"));a&&new RegisterForm(e.target)})),$(document).on("submit",".js__ajax-passwd-change",(e=>{e.preventDefault(),new ProfileForm(e.target)})),$(document).on("submit",".js__product-form-ajax",(e=>{e.preventDefault(),new ProductForm(e.target)})),$(document).on("click",".js__personal-order",(function(e){if(e.preventDefault(),this.dataset.href&&this.dataset.modalId){let e="#"+this.dataset.modalId,t=()=>{document.querySelector(e)&&window.showModal(e)};document.querySelector(e)?t():loadAndReplace(this.dataset.href,e,t)}}))}));